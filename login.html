<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' tauri:; style-src 'self' 'unsafe-inline'; connect-src 'self' http: https: tauri: ipc:" />
    <meta http-equiv="X-Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' tauri:; style-src 'self' 'unsafe-inline'; connect-src 'self' http: https: tauri: ipc:" />
    <title>EasyCLI</title>
    <link rel="stylesheet" href="css/login.css">

    <script src="js/config-manager.js"></script>
    <script>
        // Dev convenience: reload on Cmd/Ctrl+R
        window.addEventListener('keydown', function (e) {
            if ((e.metaKey || e.ctrlKey) && (e.key === 'r' || e.key === 'R')) {
                e.preventDefault();
                location.reload();
            }
        });

        (async () => {
            try {
                // Disable maximize on Windows to match desktop UX
                const isWindows = navigator.userAgent.toLowerCase().includes('windows');
                const getCurrentWindow = window.__TAURI__?.window?.getCurrent;
                if (isWindows && typeof getCurrentWindow === 'function') {
                    const currentWindow = getCurrentWindow();
                    if (currentWindow && typeof currentWindow.setMaximizable === 'function') {
                        await currentWindow.setMaximizable(false);
                    }
                }
            } catch (err) {
                console.warn('Disable maximize failed:', err);
            }
        })();
    </script>
</head>

<body>

    <div class="cards-container">
        <div class="card selected" id="local-card">
            <div class="card-icon">ğŸ’»</div>
            <h2 class="card-title">æœ¬åœ°</h2>
            <p class="card-description">åœ¨æœ¬åœ°è¿è¡Œ CLIProxyAPI æœåŠ¡å™¨ã€‚</p>
        </div>

        <div class="card" id="remote-card">
            <div class="card-icon">ğŸŒ</div>
            <h2 class="card-title">è¿œç¨‹</h2>
            <p class="card-description">è¿œç¨‹æ§åˆ¶ CLIProxyAPI æœåŠ¡å™¨ã€‚</p>
        </div>
    </div>

    <div class="remote-url-section" id="remote-url-section">
        <div class="remote-url-label">è¿œç¨‹åœ°å€ï¼š</div>
        <input type="text" class="remote-url-input" id="remote-url-input" value="http://www.example.com:8317" />
        <div class="password-label">å¯†ç ï¼š</div>
        <input type="password" class="password-input" id="password-input" placeholder="è¯·è¾“å…¥å¯†ç " />
    </div>

    <div class="proxy-section" id="proxy-section">
        <div class="proxy-label">ä»£ç†æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰ï¼š</div>
        <input type="text" class="proxy-input" id="proxy-input"
            placeholder="http://host:port or https://host:port or socks5://user:pass@host:port" />
        <div class="proxy-help">æ”¯æŒ HTTPã€HTTPS å’Œ SOCKS5 ä»£ç†æœåŠ¡å™¨</div>
    </div>

    <button class="continue-btn" id="continue-btn" onclick="window.__onConnect && window.__onConnect()">è¿æ¥</button>

    <div class="progress-container" id="progress-container">
        <div class="progress-label" id="progress-label">æ­£åœ¨ä¸‹è½½ CLIProxyAPI...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">0%</div>
    </div>

    <div class="error-toast" id="error-toast"></div>
    <div class="success-toast" id="success-toast"></div>

    <div class="update-dialog" id="update-dialog">
        <div class="update-dialog-content">
            <div class="update-dialog-title">å‘ç°æ–°ç‰ˆæœ¬</div>
            <div class="update-dialog-message" id="update-dialog-message">
                å‘ç°æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œæ˜¯å¦æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ
            </div>
            <div class="update-dialog-buttons">
                <button class="update-dialog-btn cancel" id="update-cancel-btn">ç¨åæ›´æ–°</button>
                <button class="update-dialog-btn update" id="update-confirm-btn">ç«‹å³æ›´æ–°</button>
            </div>
        </div>
    </div>

    <div class="password-dialog" id="password-dialog">
        <div class="password-dialog-content">
            <div class="password-dialog-title">è®¾ç½®è¿œç¨‹ç®¡ç†å¯†ç </div>
            <div class="password-dialog-message">
                ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¯·ä¸ºè¿œç¨‹ç®¡ç†åŠŸèƒ½è®¾ç½®å¯†ç ã€‚
            </div>
            <div class="password-input-group">
                <label class="password-input-label" for="password-input-1">å¯†ç ï¼š</label>
                <input type="password" class="password-input-field" id="password-input-1"
                    placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="password-input-group">
                <label class="password-input-label" for="password-input-2">ç¡®è®¤å¯†ç ï¼š</label>
                <input type="password" class="password-input-field" id="password-input-2"
                    placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
            </div>
            <div class="password-dialog-buttons">
                <button class="password-dialog-btn cancel" id="password-cancel-btn">å–æ¶ˆ</button>
                <button class="password-dialog-btn save" id="password-save-btn">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script src="js/login.js"></script>
</body>

</html>